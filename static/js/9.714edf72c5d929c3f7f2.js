webpackJsonp([9],{"3AbA":function(t,a){},"6MYg":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("mvHQ"),i=e.n(s),n=e("gRE1"),o=e.n(n),l=e("Mitt"),r=e("ignk"),c=e("Bfwr"),d=(l.a,r.a,c.a,{data:function(){return{topinfo:{title:""},staffWsEmpCardList:[],targetId:"",show1:!1,loaddingText:"",oilcardpay:0,money:0,bankpay:0,wechatpay:0,alipay:0,p1:0,refuelStaffWsOrderList:{},nowdate:"",showbtn:!1,gasStationWsOrder:{},gasStationWsPayList:[],refuelStaffWsList:[],sinfo:{}}},created:function(){window.history&&window.history.pushState&&(history.pushState(null,null,document.URL),window.addEventListener("popstate",this.onBrowserBack,!1)),this.beginPosWorkSettle()},mounted:function(){this.topinfo.title=this.$store.state.POS_province},destroyed:function(){window.removeEventListener("popstate",this.onBrowserBack,!1)},methods:{onBrowserBack:function(){history.pushState(null,null,document.URL)},showDetail:function(t){var a=t.currentTarget.nextElementSibling.style.display;t.currentTarget.nextElementSibling.style.display="none"===a?"block":"none"},beginPosWorkSettle:function(){var t=this;this.loaddingText="正在开始班结...";var a=this.$localStorage.getStorage("deviceInfo"),e="";e=null===a?1:a.posNo,this.show1=!0,this.$http.get("/store/json/refuel_pos_ws/beginWorkSettle",{pos:e}).then(function(a){console.log(a),"success"==a.result?"1"===a.data.resultMsg?(t.loaddingText="正在班结，请勿离开...",t.listTask()):(t.show1=!1,t.gasStationWsOrder=a.data.gasStationWsOrder,t.gasStationWsPayList=a.data.gasStationWsPayList,t.refuelStaffWsList=a.data.refuelStaffWsList,t.sinfo=a.data,t.targetId=a.data.gasStationTask.targetId,console.log(t.refuelStaffWsList),t.nowdate=a.currentTime,t.showbtn=!0):(t.show1=!1,t.$dialog.alert({mes:a.info,callback:function(){t.$router.push("/indexV2")}})),console.log(a)}).catch(function(a){t.$dialog.alert({mes:"网络繁忙，请稍后再试！"}),t.show1=!1,console.log(a)})},listTask:function(){var t=this,a=this.$localStorage.getStorage("deviceInfo"),e="";e=null===a?1:a.posNo,this.$http.get("/store/json/refuel_pos_ws/listTask",{pos:e}).then(function(a){if("success"==a.result){var e=a.data;e&&0!==e.length?e.forEach(function(a){1===a.status?setTimeout(function(){t.listTask()},1e3):t.getPendingWsData(a.targetId)}):(t.show1=!1,t.$dialog.alert({mes:null===a.info?"未获取到班结数据！":a.info}))}else t.show1=!1,t.$dialog.alert({mes:null===a.info?"网络繁忙，请稍后再试！":a.info});console.log(a)}).catch(function(a){t.$dialog.alert({mes:"网络繁忙，请稍后再试！"}),t.show1=!1,console.log(a)})},getPendingWsData:function(t){var a=this,e=this.$localStorage.getStorage("deviceInfo"),s="";s=null===e?1:e.posNo,this.$http.get("/store/json/refuel_pos_ws/getPendingWsData",{pos:s,"gasStationTask.targetId":t}).then(function(t){console.log(t),"success"===t.result?(a.staffWsEmpCardList=t.data.staffWsEmpCardList,a.gasStationWsOrder=t.data.gasStationWsOrder,a.gasStationWsPayList=t.data.gasStationWsPayList,a.refuelStaffWsList=t.data.refuelStaffWsList,a.sinfo=t.data,a.targetId=t.data.gasStationTask.targetId,a.nowdate=t.currentTime,a.showbtn=!0):a.$dialog.alert({mes:t.info,callback:function(){a.$router.push("/indexV2")}}),a.show1=!1}).catch(function(t){a.$dialog.alert({mes:"网络繁忙，请稍后再试！"}),a.show1=!1,console.log(t)})},delWsData:function(){var t=this;this.$dialog.confirm({title:'<div style="text-align: center;">温馨提示</div>',mes:'<div style="text-align: center;">确定要撤销班结吗？</div>',opts:[{txt:"取消",color:!1,callback:function(){}},{txt:"确定",color:!0,callback:function(){var a=t.$localStorage.getStorage("deviceInfo"),e="";e=null===a?1:a.posNo,t.$dialog.loading.open("正在撤销班结，请稍后..."),t.$http.get("/store/json/refuel_pos_ws/discardWsData",{pos:e,"gasStationTask.targetId":t.targetId}).then(function(a){console.log(a),"success"===a.result?t.$dialog.alert({mes:"撤销成功",callback:function(){t.$router.push("/indexV2")}}):t.$dialog.alert({mes:"撤销失败"}),t.$dialog.loading.close()}).catch(function(a){t.$dialog.alert({mes:"系统异常!"}),t.$dialog.loading.close(),console.log(a)})}}]})},acceptWsData:function(){var t=this;this.$dialog.confirm({title:'<div style="text-align: center;">温馨提示</div>',mes:'<div style="text-align: center;">确定要完成全站交班吗？</div>',opts:[{txt:"取消",color:!1,callback:function(){}},{txt:"确定",color:!0,callback:function(){var a=t.$localStorage.getStorage("deviceInfo"),e="";e=null===a?1:a.posNo,t.$dialog.loading.open("正在交班，请稍后..."),t.$http.get("/store/json/refuel_pos_ws/acceptWsData",{pos:e,"gasStationTask.targetId":t.targetId}).then(function(a){if(console.log(a),"success"===a.result){t.printStationData();var e=["title","加油员","班次","加油笔数","现金支付","微信支付","支付宝支付","银行卡支付","合计应收","实收金额","交接班时间"];t.refuelStaffWsList.forEach(function(a){var s=0;if(a.refuelStaffWsPayList.forEach(function(a){"100"==a.payMode?t.money=a.payAmount:"210"==a.payMode?t.wechatpay=a.payAmount:"170"==a.payMode?t.oilcardpay=a.payAmount:"200"==a.payMode?t.alipay=a.payAmount:"320002"==a.payMode?s=a.payAmount:t.p1=a.payAmount}),null!==a&&null!==a.refuelStaffWsOrder&&null!==a.refuelStaffWsOrder.workNo){var n=parseInt(a.refuelStaffWsOrder.workNo);n<10&&(n="0"+n),n=a.refuelStaffWsOrder.jzDate.toString().replace(/-/g,"")+n;var l={title:"交班明细"};l.cashierName=a.refuelStaffWsOrder.cashierName,l.workNo=n,l.billCount=a.refuelStaffWsOrder.billCount,l.money=t.money,l.wechatpay=t.wechatpay,l.alipay=t.alipay,l.bankpay=s,l.recAmount=a.refuelStaffWsOrder.recAmount,l.nrecAmount=a.refuelStaffWsOrder.nrecAmount,l.wsDate=a.refuelStaffWsOrder.wsDate;var r=[];o()(l).forEach(function(t,a){var s=new Object;s.OilKey=e[a],s.OilValue=t,r.push(s)}),console.log(r),t.$bridge.printdata(encodeURIComponent(i()(r))),t.money=0,t.wechatpay=0,t.oilcardpay=0,t.alipay=0,s=0,t.p1=0}else t.$dialog.alert({mes:"打印失败，数据不完整！"})}),t.$dialog.alert({mes:"交班成功",callback:function(){t.$router.push("/indexV2")}})}else t.$dialog.alert({mes:a.info});t.$dialog.loading.close()}).catch(function(a){t.$dialog.alert({mes:"网络繁忙，请稍后再试！"}),console.log(a),t.$dialog.loading.close()})}}]})},printStationData:function(){var t=["title","班次","加油笔数","其他加油笔数","员工卡加油笔数","员工卡加油总金额","现金支付","微信支付","支付宝支付","银行卡支付","加油卡积分支付","加油卡支付","合计应收","实收金额"],a=this.gasStationWsOrder,e=0,s=0,n=0,l=0,r=0,c=0;this.gasStationWsPayList.forEach(function(t){"100"==t.payMode?e=t.payAmount:"210"==t.payMode?s=t.payAmount:"170"==t.payMode?n=t.payAmount:"200"==t.payMode?l=t.payAmount:"160"==t.payMode?r=t.payAmount:"320002"==t.payMode&&(c=t.payAmount)});var d=parseInt(a.workNo);d<10&&(d="0"+d),d=a.jzDate.toString().replace(/-/g,"")+d;var u={title:"全站交班明细"};u.workNo=d,u.billCount=a.billCount,u.pcBillCount=this.sinfo.pcBillCount,u.npcBillCount=this.sinfo.npcBillCount,u.npcPayAmount=this.sinfo.npcPayAmount,u.money=e,u.wxamount=s,u.alipay=l,u.bankpay=c,u.jfpay=r,u.oilcardpay=n,u.recAmount=a.recAmount,u.nrecAmount=a.nrecAmount;var p=[];o()(u).forEach(function(a,e){var s=new Object;s.OilKey=t[e],s.OilValue=a,p.push(s)}),this.$bridge.printdata(encodeURIComponent(i()(p)))}},components:{vheader:l.a,XTable:r.a,Loading:c.a},filters:{substr:function(t){return t?t.substring(t.length-6,t.length):""},timetodate:function(t){return t?t.substring(0,t.indexOf(" ")):""}}}),u={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page handover-pagev2"},[e("div",{staticClass:"handoverv2"},[e("vheader",{attrs:{title:t.topinfo.title,isShowSignup:!0,isShowHome:!0}}),t._v(" "),e("div",{staticClass:"oilinfo"},[e("ul",[e("li",[e("div",{staticClass:"info-left"},[e("p",{staticClass:"info-txt"},[t._v("加油笔数")]),t._v(" "),e("p",{staticClass:"info-value"},[t._v(t._s(null==t.gasStationWsOrder.billCount?0:t.gasStationWsOrder.billCount))])]),t._v(" "),e("div",{staticClass:"info-right"},[e("p",{staticClass:"info-txt"},[t._v("应收金额(元)")]),t._v(" "),e("p",{staticClass:"info-value"},[t._v(t._s(null==t.gasStationWsOrder.recAmount?0:t.gasStationWsOrder.recAmount))])])]),t._v(" "),e("li",[e("div",{staticClass:"info-left"},[e("p",{staticClass:"info-txt"},[t._v("实收金额(元)")]),t._v(" "),e("p",{staticClass:"info-value"},[t._v(t._s(null==t.gasStationWsOrder.nrecAmount?0:t.gasStationWsOrder.nrecAmount))])]),t._v(" "),e("div",{staticClass:"info-right"},[e("p",{staticClass:"info-txt"},[t._v("差额(元)")]),t._v(" "),e("p",{staticClass:"info-value"},[t._v(t._s(null==t.gasStationWsOrder.chaAmount?0:t.gasStationWsOrder.chaAmount))])])]),t._v(" "),e("div",{staticClass:"clear"})])]),t._v(" "),e("div",{staticClass:"paytypeList emppaytype"},[e("ul",t._l(t.gasStationWsPayList,function(a,s){return e("li",{key:s},[210==a.payMode?e("div",[t._m(0,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):200==a.payMode?e("div",[t._m(1,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):100==a.payMode?e("div",[t._m(2,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):320002==a.payMode?e("div",[t._m(3,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):t._e()])}),0),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"emplist"},[e("h2",[t._v("员工列表")]),t._v(" "),t._l(t.refuelStaffWsList,function(a){return e("ul",[e("div",{staticClass:"empcontent",on:{click:function(a){return t.showDetail(a)}}},[e("li",[e("div",{staticClass:"emp-left"},[e("span",{staticClass:"emp-txt"},[t._v("加油员:")]),t._v(" "),e("span",{staticClass:"emp-value"},[t._v(t._s(a.refuelStaffWsOrder.cashierName))])]),t._v(" "),t._m(4,!0),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"emp-left"},[e("span",{staticClass:"emp-txt"},[t._v("应收金额:")]),t._v(" "),e("span",{staticClass:"emp-value"},[t._v(t._s(a.refuelStaffWsOrder.recAmount))])]),t._v(" "),e("div",{staticClass:"emp-right"},[e("span",{staticClass:"emp-txt"},[t._v("应缴现金金额:")]),t._v(" "),e("span",{staticClass:"emp-value"},[t._v(t._s(a.refuelStaffWsOrder.nrecAmount))])]),t._v(" "),e("div",{staticClass:"clear"})])]),t._v(" "),e("div",{staticClass:"paytypeList",staticStyle:{display:"none"}},[e("ul",t._l(a.refuelStaffWsPayList,function(a){return e("li",[210==a.payMode?e("div",[t._m(5,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):200==a.payMode?e("div",[t._m(6,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):100==a.payMode?e("div",[t._m(7,!0),t._v(" "),e("div",{staticClass:"paytype-value"},[t._v(t._s(a.payAmount))])]):t._e()])}),0),t._v(" "),e("div",{staticClass:"clear"}),t._v(" "),e("div",{staticClass:"data-table"},[e("div",{staticClass:"data-grid"},[e("x-table",{staticStyle:{"background-color":"#fff"},attrs:{"cell-bordered":!1,"content-bordered":!0}},[e("thead",[e("tr",[e("th",[t._v("卡号")]),t._v(" "),e("th",{staticStyle:{width:"40%"}},[t._v("接班余额/当前余额")]),t._v(" "),e("th",[t._v("加油量")]),t._v(" "),e("th",[t._v("加油金额")])])]),t._v(" "),e("tbody",t._l(a.refuelStaffWsEmpCardList,function(a){return e("tr",[e("td",[t._v(t._s(t._f("substr")(a.cardNo)))]),t._v(" "),e("td",{staticStyle:{width:"40%"}},[e("div",{staticClass:"tbody-line"},[t._v(t._s(a.handBalance))]),t._v(" "),e("div",{staticClass:"tbody-line"},[t._v(t._s(a.currentBalance))])]),t._v(" "),e("td",[t._v(t._s(a.payVol))]),t._v(" "),e("td",[t._v(t._s(a.payAmount))])])}),0)])],1)])])])})],2)],1),t._v(" "),e("loading",{attrs:{show:t.show1,text:t.loaddingText}}),t._v(" "),t.showbtn?e("footer",{staticClass:"btn-fixed-bottom"},[e("yd-button",{staticClass:"save-submit",attrs:{size:"large",type:"danger"},nativeOn:{click:function(a){return t.acceptWsData(a)}}},[t._v("提交全站班结")]),t._v(" "),e("yd-button",{staticClass:"save-submit",attrs:{size:"large",type:"danger"},nativeOn:{click:function(a){return t.delWsData(a)}}},[t._v("撤销班结")])],1):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("xYjW"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("微信支付")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("9O5e"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("支付宝")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("sZcE"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("现金")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("CtVA"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("银行卡")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"emp-right"},[a("span",[this._v("收款明细>>")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("xYjW"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("微信支付")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("9O5e"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("支付宝")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("div",{staticClass:"paytype-logos"},[a("img",{attrs:{src:e("sZcE"),width:"30",height:"30"}}),this._v(" "),a("span",{staticClass:"paytype-name"},[this._v("现金")])])}]};var p=e("VU/8")(d,u,!1,function(t){e("3AbA")},null,null);a.default=p.exports},WGHa:function(t,a){},ignk:function(t,a,e){"use strict";Boolean,Boolean,Boolean;var s={name:"x-table",props:{fullBordered:Boolean,cellBordered:{type:Boolean,default:!0},contentBordered:{type:Boolean,default:!0}}},i={render:function(){var t=this.$createElement;return(this._self._c||t)("table",{staticClass:"vux-table",class:{"vux-table-bordered":this.fullBordered,"vux-table-no-cell-bordered":!this.cellBordered,"vux-table-no-content-bordered":!this.contentBordered}},[this._t("default")],2)},staticRenderFns:[]};var n=e("VU/8")(s,i,!1,function(t){e("WGHa")},null,null);a.a=n.exports}});