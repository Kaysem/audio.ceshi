webpackJsonp([21],{"2MTf":function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=e("mvHQ"),i=e.n(o),s=e("gRE1"),n=e.n(s),r=e("Gu7T"),l=e.n(r),c=e("Mitt"),d=e("Bfwr"),u=e("UNGY"),f=e("rHil"),p=e("2sLL"),h=e("7Ah8"),v=(c.a,d.a,u.a,f.a,p.a,h.a,{data:function(){return{topinfo:{title:"班结历史"},showLoading:!1,orderList:[],startdate:"",enddate:"",list:[],defaultValue:["请选择账号"],pageIndex:1,pageSize:5}},mounted:function(){this.getAcctList(),this.queryOrder()},methods:{getAcctList:function(){var t=this;this.$http.get("/store/json/login/getSysOperatorList").then(function(a){if(console.log(a),"success"==a.result){var e=[];a.data.forEach(function(t){var a=t.userName+"("+t.realName+")";e.push(a)}),t.list.push(e)}}).catch(function(t){console.log(t)})},loadList:function(){var t=this;this.pageIndex++,this.$http.getAsJson("/refuel/json/query/queryWsHistory",{page:this.pageIndex,rows:10}).then(function(a){if(console.log(a),"success"==a.result){var e=a.data.items;if(t.orderList=[].concat(l()(t.orderList),l()(e)),a.data.page<a.data.totalPage)return t.showLoading=!1,void t.$refs.infinitescrollDemo.$emit("ydui.infinitescroll.loadedDone");t.$refs.infinitescrollDemo.$emit("ydui.infinitescroll.finishLoad")}t.showLoading=!1}).catch(function(a){t.showLoading=!1,console.log(a)})},queryOrder:function(){var t=this;this.$nextTick(function(){t.showLoading=!0,setTimeout(function(){t.$http.getAsJson("/refuel/json/query/queryWsHistory",{page:t.pageIndex,rows:10}).then(function(a){if(console.log(a),"success"==a.result){a.data.items;var e=a.data.items;if(t.orderList=[].concat(l()(t.orderList),l()(e)),a.data.page<a.data.totalPage)return t.showLoading=!1,void t.$refs.infinitescrollDemo.$emit("ydui.infinitescroll.loadedDone");t.$refs.infinitescrollDemo.$emit("ydui.infinitescroll.finishLoad")}else t.$dialog.alert({mes:null==a.info?"系统繁忙，请稍后再试!":a.info});t.showLoading=!1}).catch(function(a){t.showLoading=!1,console.log(a)})},500)})},change:function(t){this.$refs.username.value=t,console.log("change",t)},setToday:function(t){var a=new Date,e=a.getMonth()+1,o=a.getDate();e<10&&(e="0"+e),o<10&&(o="0"+o),this.value7=a.getFullYear()+"-"+e+"-"+o,console.log("set today ok")},printData:function(t){var a=this;console.log(t),this.$dialog.confirm({title:'<div style="text-align: center;">提示</div>',mes:'<div style="text-align: center;">是否补打班结小票？</div>',opts:[{txt:"否",color:!1,callback:function(){console.log("1111")}},{txt:"是",color:!0,callback:function(){a.showLoading=!0,a.$http.getAsJson("/refuel/json/find/findWsData",{wsId:t.wsId}).then(function(t){if("success"==t.result){a.staffWsEmpCardList=t.data.staffWsEmpCardList,a.gasStationWsOrder=t.data.gasStationWsOrder,a.gasStationWsPayList=t.data.gasStationWsPayList,a.refuelStaffWsList=t.data.refuelStaffWsList,a.sinfo=t.data,a.printStationData();var e=["title","加油员","班次","加油笔数","现金支付","微信支付","支付宝支付","银行卡支付","合计应收","实收金额","交接班时间"];a.refuelStaffWsList.forEach(function(t){var o=0;if(t.refuelStaffWsPayList.forEach(function(t){"100"==t.payMode?a.money=t.payAmount:"210"==t.payMode?a.wechatpay=t.payAmount:"170"==t.payMode?a.oilcardpay=t.payAmount:"200"==t.payMode?a.alipay=t.payAmount:"320002"==t.payMode?o=t.payAmount:a.p1=t.payAmount}),null!==t&&null!==t.refuelStaffWsOrder&&null!==t.refuelStaffWsOrder.workNo){var s=parseInt(t.refuelStaffWsOrder.workNo);s<10&&(s="0"+s),s=t.refuelStaffWsOrder.jzDate.toString().replace(/-/g,"")+s;var r={title:"交班明细"};r.cashierName=t.refuelStaffWsOrder.cashierName,r.workNo=s,r.billCount=t.refuelStaffWsOrder.billCount,r.money=a.money,r.wechatpay=a.wechatpay,r.alipay=a.alipay,r.bankpay=o,r.recAmount=t.refuelStaffWsOrder.recAmount,r.nrecAmount=t.refuelStaffWsOrder.nrecAmount,r.wsDate=t.refuelStaffWsOrder.wsDate;var l=[];n()(r).forEach(function(t,a){var o=new Object;o.OilKey=e[a],o.OilValue=t,l.push(o)}),console.log(l),a.$bridge.printdata(encodeURIComponent(i()(l))),a.money=0,a.wechatpay=0,a.oilcardpay=0,a.alipay=0,o=0,a.p1=0}else a.$dialog.alert({mes:"打印失败，数据不完整！"})}),a.$dialog.alert({mes:"交班成功",callback:function(){a.$router.push("/indexV2")}})}else a.$dialog.alert({mes:t.info});a.showLoading=!1}).catch(function(t){a.showLoading=!1,console.log(t)})}}]})},printStationData:function(){var t=["title","班次","加油笔数","其他加油笔数","员工卡加油笔数","现金支付","微信支付","支付宝支付","银行卡支付","加油卡积分支付","加油卡支付","合计应收","实收金额"],a=this.gasStationWsOrder,e=0,o=0,s=0,r=0,l=0,c=0;this.gasStationWsPayList.forEach(function(t){"100"==t.payMode?e=t.payAmount:"210"==t.payMode?o=t.payAmount:"170"==t.payMode?s=t.payAmount:"200"==t.payMode?r=t.payAmount:"160"==t.payMode?l=t.payAmount:"320002"==t.payMode&&(c=t.payAmount)});var d=parseInt(a.workNo);d<10&&(d="0"+d),d=a.jzDate.toString().replace(/-/g,"")+d;var u={title:"全站交班明细"};u.workNo=d,u.billCount=a.billCount,u.pcBillCount=this.sinfo.pcBillCount,u.npcBillCount=this.sinfo.npcBillCount,u.money=e,u.wxamount=o,u.alipay=r,u.bankpay=c,u.jfpay=l,u.oilcardpay=s,u.recAmount=a.recAmount,u.nrecAmount=a.nrecAmount;var f=[];n()(u).forEach(function(a,e){var o=new Object;o.OilKey=t[e],o.OilValue=a,f.push(o)}),this.$bridge.printdata(encodeURIComponent(i()(f)))}},components:{vheader:c.a,loading:d.a,Datetime:u.a,Group:f.a,XButton:p.a,PopupPicker:h.a}}),g={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"queryorder"},[e("vheader",{attrs:{title:t.topinfo.title,isShowHome:!0}}),t._v(" "),e("div",{staticClass:"content",staticStyle:{padding:"2px 10px"}},[e("yd-infinitescroll",{ref:"infinitescrollDemo",attrs:{callback:t.loadList}},[t._l(t.orderList,function(a,o){return e("ul",{key:o,staticClass:"orderlist",attrs:{slot:"list"},slot:"list"},[e("li",[e("div",{staticClass:"order-data-left order-data-desc"},[t._v("记账日期")]),t._v(" "),e("div",{staticClass:"order-data-right"},[t._v(t._s(a.jzDate))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"order-data-left order-data-desc"},[t._v("金额")]),t._v(" "),e("div",{staticClass:"order-data-right"},[t._v(t._s(a.nrecAmount))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"order-data-left order-data-desc"},[t._v("班次号")]),t._v(" "),e("div",{staticClass:"order-data-right"},[t._v(t._s(a.workNo))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"order-data-left order-data-desc"},[t._v("班结时间")]),t._v(" "),e("div",{staticClass:"order-data-right"},[t._v(t._s(a.wsDate))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",{staticClass:"printbtn",on:{click:function(e){return t.printData(a)}}},[t._v("补打班结小票")]),t._v(" "),e("div",{staticClass:"clear"})])}),t._v(" "),e("span",{attrs:{slot:"doneTip"},slot:"doneTip"},[t._v("没有数据啦~~")])],2)],1),t._v(" "),e("loading",{attrs:{show:t.showLoading,text:""}})],1)},staticRenderFns:[]};var y=e("VU/8")(v,g,!1,function(t){e("qRc+")},null,null);a.default=y.exports},"qRc+":function(t,a){}});