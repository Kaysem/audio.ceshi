webpackJsonp([23],{fmTE:function(t,a,e){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var s=e("Mitt"),l=e("Bfwr"),n=(s.a,l.a,{}),o={data:function(){return{topinfo:{title:"地罐交接-结束卸油"},mblnr:"",showLoading:!1,unLoadInfo:{},unloadEnd:{},tankNo:"",isStable:!0,StableInfo:"",stableFlag:"",sheetID:"",oTime:{hours:0,minutes:0,seconds:0},timeIntervalid:null}},created:function(){},beforeMount:function(){clearInterval(this.timeIntervalid),this.sheetID=this.$route.query.sheetID,this.mblnr=this.$route.query.mblnr,this.tankNo=this.$route.query.tankNo,this.unloadEnd=this.$route.query.unloadEnd,"1"===this.unloadEnd?this.queryUnloadedTankInfo():this.endTankUnload()},mounted:function(){},methods:{dateParse:function(t){return Date.parse(new Date(t))},getDateTime:function(t){var a=t%864e5,e=Math.floor(t/36e5),s=a%36e5,l=Math.floor(s/6e4),n=s%6e4,o=Math.round(n/1e3);return console.log(e,l,o),{hours:e,minutes:l,seconds:o}},goedit:function(){console.log(111),this.$router.push({path:"/receiveoil/edit"})},endTankUnload:function(){var t=this;this.showLoading=!0;var a=this.$route.query.sheetID,e=this.$route.query.tankNo;this.$http.get("/store/json/delivery_sheet/endTankUnload",{"refuelUnloadSheet.sheetID":a,"refuelUnloadSheet.tankNo":e}).then(function(a){if(console.log(a,"999978"),"success"===a.result){t.unLoadInfo=a.data,n=a.data,t.stableFlag=a.data.stableFlag,a.data!={}&&t.$localStorage.setStorage("storeData",a.data);var e=t.unLoadInfo.endOilVol/(t.unLoadInfo.endOilVol+t.unLoadInfo.endWaterVol+t.unLoadInfo.endEmpVol)*100;t.unLoadInfo.tankHeight=e+"%",t.StabilizingOilTime()}else t.$dialog.alert({mes:null===a.info?"网络异常,请稍后再试...":a.info});t.showLoading=!1,console.log(a)}).catch(function(a){t.showLoading=!1,console.log(a)})},sureEndTankUnload:function(){var t=this;this.showLoading=!0;var a=this.unLoadInfo.id;this.$http.get("/store/json/delivery_sheet/sureEndTankUnload",{"refuelDeliveryUnloadTank.id":a}).then(function(a){"success"===a.result?t.$dialog.alert({mes:"卸油成功",callback:function(){t.$router.go(-1)}}):t.$dialog.alert({mes:null===a.info?"网络异常,请稍后再试...":a.info}),t.showLoading=!1,console.log(a)}).catch(function(a){console.log(a),t.showLoading=!1})},queryUnloadedTankInfo:function(){var t=this;this.showLoading=!0;var a=this.$route.query.sheetID,e=this.$route.query.tankNo;this.$http.get("/store/json/delivery_sheet/queryUnloadedTankInfo",{"refuelUnloadSheet.sheetID":a,"refuelUnloadSheet.tankNo":e}).then(function(a){if("success"===a.result){t.unLoadInfo=a.data,n=a.data,console.log(t.unLoadInfo,"+++++"),t.stableFlag=t.unLoadInfo.stableFlag,a.data!={}&&t.$localStorage.setStorage("editData",a.data);var e=t.unLoadInfo.endOilVol/(t.unLoadInfo.endOilVol+t.unLoadInfo.endWaterVol+t.unLoadInfo.endEmpVol)*100;t.unLoadInfo.tankHeight=e+"%",t.StabilizingOilTime()}else t.$dialog.alert({mes:null===a.info?"网络异常,请稍后再试...":a.info});t.showLoading=!1,console.log(a)}).catch(function(a){console.log(a),t.showLoading=!1})},StabilizingOilTime:function(){console.log("计时执行了");console.log(this,"稳油this");var t=n.stableFlag;console.log(n,"这是状态");var a=n.beginStableTime,e=n.endStableTime;console.log(t,a,e,"这是状态"),this.timeSet(t,a,e)},timeSet:function(t,a,e){var s=this;if("1"==t)s.isStable=!0,clearInterval(s.timeIntervalid),console.log("自主定时器清除了",s.timeIntervalid),s.timeIntervalid=setInterval(function(){var t=Date.parse(new Date)-s.dateParse(a);s.oTime=s.getDateTime(t),console.log(s.oTime,"999888777",s.timeIntervalid)},1e3),console.log(s.timeIntervalid,"我是定时器后面");else if("2"==t){s.isStable=!0;var l=s.dateParse(e)-s.dateParse(a);s.oTime=s.getDateTime(l),console.log(s.oTime,"999888776")}else s.isStable=!1,console.log("stableFlag不存在")},beginStable:function(){var t=this,a=this;a.isStable=!0,this.$http.get("/store/json/delivery_sheet/startTankUnloadStable",{"refuelUnloadSheet.sheetID":this.sheetID,"refuelUnloadSheet.tankNo":this.unLoadInfo.tankNo}).then(function(e){console.log(e,"开始稳油"),"success"==e.result?null!=e.data&&(a.stableFlag=e.data.stableFlag,console.log(e.data.stableFlag,e.data.beginStableTime,e.data.endStableTime," 开始稳油按钮返回"),a.timeSet(e.data.stableFlag,e.data.beginStableTime,e.data.endStableTime)):(a.isStable=!1,t.$dialog.alert({mes:null===response.info?"网络异常,请稍后再试...":response.info,callback:function(){}}))}).catch(function(t){console.log(t)})},endStable:function(){var t=this,a=this;a.isStable=!0,clearInterval(a.timeIntervalid),a.$http.get("/store/json/delivery_sheet/endTankUnloadStable",{"refuelUnloadSheet.sheetID":a.sheetID,"refuelUnloadSheet.tankNo":a.unLoadInfo.tankNo}).then(function(e){if(console.log(e.data,"999978"),"success"===e.result){e.data=={}&&null==e.data||(a.unLoadInfo=e.data,a.stableFlag=e.data.stableFlag,console.log(e.data.stableFlag,e.data.beginStableTime,e.data.endStableTime," 结束稳油按钮返回"),a.timeSet(e.data.stableFlag,e.data.beginStableTime,e.data.endStableTime),a.$localStorage.setStorage("storeData",e.data));var s=t.unLoadInfo.endOilVol/(t.unLoadInfo.endOilVol+t.unLoadInfo.endWaterVol+t.unLoadInfo.endEmpVol)*100;t.unLoadInfo.tankHeight=s+"%"}else a.isStable=!1,t.$dialog.alert({mes:null===e.info?"网络异常,请稍后再试...":e.info});t.showLoading=!1,console.log(e)}).catch(function(a){t.showLoading=!1,console.log(a)})}},beforeDestroy:function(){clearInterval(this.timeIntervalid)},components:{vheader:s.a,loading:l.a}},i={render:function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"page"},[e("div",{staticClass:"inspected receiveoil"},[e("vheader",{attrs:{title:t.topinfo.title,isUserInfo:!1,isShowHome:!0}}),t._v(" "),e("div",{staticClass:"bound-order-title"},[e("div",{staticClass:"order-no-txt"},[t._v("出库单号")]),t._v(" "),e("div",{staticClass:"order-no-value"},[t._v(t._s(t.mblnr))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"oiltank-data"},[e("div",{staticClass:"tank-btns"},[e("yd-button",{staticClass:"tank-btn",attrs:{type:"danger",bgcolor:"#efefef",color:"#888"}},[t._v(t._s(t.tankNo)+"#油罐")]),t._v(" "),e("div",{staticStyle:{display:"inline-block"},on:{click:function(a){return t.endStable()}}},[e("yd-button",{directives:[{name:"show",rawName:"v-show",value:1==t.stableFlag,expression:"stableFlag == 1"}],attrs:{type:"primary",bgcolor:"#04BE02",color:"#fff"}},[t._v("结束稳油")])],1),t._v(" "),e("div",{staticStyle:{display:"inline-block"}},[e("yd-button",{directives:[{name:"show",rawName:"v-show",value:2==t.stableFlag,expression:"stableFlag == 2"}],attrs:{type:"disabled",disabled:""}},[t._v("已稳油")])],1),t._v(" "),e("div",{staticStyle:{display:"inline-block"},on:{click:function(a){return t.beginStable()}}},[e("yd-button",{directives:[{name:"show",rawName:"v-show",value:1!=t.stableFlag&&2!=t.stableFlag,expression:"stableFlag != 1 && stableFlag != 2"}],attrs:{type:"danger",bgcolor:"#ff6800",color:"#fff"},on:{click:function(a){return t.beginStable()}}},[t._v("开始稳油")])],1)],1),t._v(" "),e("div",{staticClass:"tank-content"},[e("div",{staticClass:"tank-content-left"},[e("span",{staticClass:"tank-oil-height",style:{height:t.unLoadInfo.tankHeight}})]),t._v(" "),e("div",{staticClass:"tank-content-right"},[e("ul",[e("li",[e("p",{staticClass:"content-txt"},[t._v("标准体积(L)")]),t._v(" "),e("p",{staticClass:"content-value"},[t._v(t._s(t.unLoadInfo.endOilNormalVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("p",{staticClass:"content-txt"},[t._v("净油体积(L)")]),t._v(" "),e("p",{staticClass:"content-value"},[t._v(t._s(t.unLoadInfo.endOilVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("p",{staticClass:"content-txt"},[t._v("空体积(L)")]),t._v(" "),e("p",{staticClass:"content-value"},[t._v(t._s(t.unLoadInfo.endEmpVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("p",{staticClass:"content-txt"},[t._v("平均温度(℃)")]),t._v(" "),e("p",{staticClass:"content-value"},[t._v(t._s(t.unLoadInfo.endTemp))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("p",{staticClass:"content-txt"},[t._v("水高(mm)")]),t._v(" "),e("p",{staticClass:"content-value"},[t._v(t._s(t.unLoadInfo.endWaterHeight))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("p",{staticClass:"content-txt valuered"},[t._v("已卸升数(L)")]),t._v(" "),e("p",{staticClass:"content-value valuered"},[t._v(t._s(null==t.unLoadInfo.unloadNormalVol?0:t.unLoadInfo.unloadNormalVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"clear"})])])]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"oil-confirm-label",staticStyle:{width:"100%","margin-right":"0","margin-left":"0","text-algin":"center","padding-left":"25px"}},[e("div",{staticClass:"jinhuo",staticStyle:{background:"#323333",color:"#fff",position:"absolute",top:"8px",padding:"3px 10px","border-radius":"16px","font-family":"PingFangSC-Medium, sans-serif"}},[t._v("进货验收")]),t._v(" "),t.isStable?e("div",{staticClass:"xycount",staticStyle:{clear:"both",margin:"0"}},[e("div",{staticClass:"xynum pd",staticStyle:{float:"right",width:"77%"}},[e("p",{staticClass:"xy-txt"},[t._v("稳油时间")]),t._v(" "),e("p",{staticClass:"xy-value"},[e("span",{staticStyle:{background:"#323333"}},[t._v(t._s(t.oTime.hours)+"小时")]),e("span",{staticStyle:{background:"#323333"}},[t._v(t._s(t.oTime.minutes)+"分钟")]),e("span",{staticStyle:{background:"#323333"}},[t._v(t._s(t.oTime.seconds)+"秒")])])]),t._v(" "),e("div",{staticClass:"clear"})]):t._e()]),t._v(" "),e("div",{staticClass:"xycount",staticStyle:{clear:"both"}},[e("div",{staticClass:"xynum pd"},[e("p",{staticClass:"xy-txt"},[t._v("卸油升数")]),t._v(" "),e("p",{staticClass:"xy-value"},[t._v(t._s(t.unLoadInfo.unloadNormalVol))])]),t._v(" "),e("div",{staticClass:"fynum pd"},[e("p",{staticClass:"xy-txt"},[t._v("付油升数")]),t._v(" "),e("p",{staticClass:"xy-value"},[t._v(t._s(t.unLoadInfo.durSaleNormalVol))])]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"oiltank-info"},[e("div",{staticClass:"q-div"},[e("ul",[t._m(0),t._v(" "),e("li",[e("div",{staticClass:"q-data-txt"},[t._v("油水总高(mm)")]),t._v(" "),e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.beginTotalHeight))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"q-data-txt"},[t._v("净油体积(L)")]),t._v(" "),e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.beginOilVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"q-data-txt"},[t._v("标准体积(L)")]),t._v(" "),e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.beginOilNormalVol))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"q-data-txt"},[t._v("平均温度(℃)")]),t._v(" "),e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.beginTemp))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("li",[e("div",{staticClass:"q-data-txt"},[t._v("时间")]),t._v(" "),e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.beginTime))]),t._v(" "),e("div",{staticClass:"clear"})]),t._v(" "),e("div",{staticClass:"clear"})])]),t._v(" "),e("div",{staticClass:"hccon"},[e("ul",[t._m(1),t._v(" "),e("li",[e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.endTotalHeight))])]),t._v(" "),e("li",[e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.endOilVol))])]),t._v(" "),e("li",[e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.endOilNormalVol))])]),t._v(" "),e("li",[e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.endTemp))])]),t._v(" "),e("li",[e("div",{staticClass:"q-data-value"},[t._v(t._s(t.unLoadInfo.endTime))])])])]),t._v(" "),e("div",{staticClass:"clear"})])],1),t._v(" "),e("loading",{attrs:{show:t.showLoading,text:""}}),t._v(" "),"1"!=t.unloadEnd?e("footer",{staticClass:"btn-fixed-bottom"},[e("yd-button",{staticClass:"save-submit",attrs:{size:"large",type:"danger"},nativeOn:{click:function(a){return t.sureEndTankUnload(a)}}},[t._v("确认结束")])],1):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,a=this._self._c||t;return a("li",{staticClass:"qc-title"},[a("span",[this._v("前尺数据")])])},function(){var t=this.$createElement,a=this._self._c||t;return a("li",{staticClass:"qc-title",staticStyle:{"text-align":"left"}},[a("span",[this._v("后尺数据")])])}]};var d=e("VU/8")(o,i,!1,function(t){e("uwMh")},null,null);a.default=d.exports},uwMh:function(t,a){}});